{"version":3,"sources":["spacewar.js"],"names":["atc","isMobile","e","n","test","substr","navigator","userAgent","vendor","window","opera","moveFps","bulletFps","pixelWeigth","w","Math","floor","innerWidth","h","innerHeight","objQuantity","objPolling","renCount","renderTime","bulletTime","moveTime","nextPolling","killCount","renderData","position","renderTemp","bullet","preState","enemy","enemyBullet","keyType","UP","RIGHT","DOWN","LEFT","SPACE","movePathList","goStop","me","getST","find","el","index","splice","gostMove","thisY","r","nowY","mainX","margin","sin","PI","xMargin","positionLimit","call","goToOut","lookPath","ps","rs","push","createEnemy","obj","name","life","shot","shotTime","movePath","look","hit","survivalTime","hitPath","map","wasHit","bulletPs","viewDom","cb","includes","indexOf","bestScore","localStorage","getItem","setItem","grapic","color","forEach","psObj","positionToXY","beginPath","rect","x","y","fillStyle","fill","action","renderType","enemyMove","shotByEnemy","nowPosition","leftlimt","rightlimt","keyCodeMap","keycode","type","actionMove","round","key","document","getElementById","innerHTML","JSON","stringify","render","objPosition","isSet","objArr","object","quantity","random","val","bulletArr","bulletPosition","enemyBulleArr","delArr","arr","gaphicShip","data","lookType","gaphic","TYPE","bestMileage","shipLookType","createObj","zark","getContext","clearRect","bulletImg","bulletObj","drawImage","enemyImg","dead","isDead","console","log","point","__x","__y","limit","addEventListener","keyCode","touch","event","preventDefault","touches","pageX","pageY","_ps","height","width","setInterval"],"mappings":"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","file":"32aa96752243aef65f9da0d0a33e239c.map","sourcesContent":["(function () {\n  var atc = {\n    isMobile: function () {\n      var e = !1;\n      return function (n) {\n        (/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|webgolds|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(n.substr(0, 4))) && (e = !0)\n      }(navigator.userAgent || navigator.vendor || window.opera), e\n    }\n  };\n  var moveFps = atc.isMobile() ? 60 : 30;\n  var bulletFps = atc.isMobile() ? 60 : 30;\n  var pixelWeigth = atc.isMobile() ? 10 : 20;\n  var w = Math.floor(window.innerWidth / pixelWeigth);\n  var h = Math.floor(window.innerHeight / pixelWeigth);\n  var objQuantity = 1;\n  var objPolling = [20, 40];\n  var renCount = 0;\n  var renderTime = 1000 / moveFps;\n  var bulletTime = 1000 / bulletFps;\n  var moveTime = 1000 / 30;\n  var nextPolling = 1;\n  var killCount = 0;\n  var renderData = {\n    position: null,\n    renderTemp: {},\n    // object: [],\n    bullet: [],\n    preState: {},\n    enemy: [],\n    enemyBullet: [],\n  };\n  var keyType = {\n    UP: false,\n    RIGHT: false,\n    DOWN: false,\n    LEFT: false,\n    SPACE: false\n  };\n\n  var movePathList = {\n    goStop: function () {\n      var me = this;\n      if (this.getST() < 6) this.position += w;\n      if (this.getST() > 80) this.position += w;\n      if (this.position > w * h - 1) {\n        renderData.enemy.find(function (el, index) {\n          if (el === me) renderData.enemy.splice(index, 1);\n        })\n      };\n    },\n    gostMove: function () {\n      var me = this;\n      var thisY = Math.floor(this.position / h);\n      var r = h / 4;\n      var nowY = Math.floor(this.mainX / w);\n      var margin = Math.sin(Math.PI / r * nowY);\n      var xMargin = Math.floor(margin * r);\n      //console.log(nowY, margin);\n      this.position = positionLimit.call(this, this.mainX + xMargin);\n\n\n      if (this.position > w * h - 1) {\n        renderData.enemy.find(function (el, index) {\n          if (el === me) renderData.enemy.splice(index, 1);\n        })\n      };\n    },\n    goToOut: function () {\n      this.position += w;\n      var me = this;\n      if (this.position > w * h - 1) {\n        renderData.enemy.find(function (el, index) {\n          if (el === me) renderData.enemy.splice(index, 1);\n        })\n      };\n    },\n  };\n\n  var lookPath = {\n    'zark': function (ps) {\n      var rs = [ps];\n      if (ps % w !== w - 1) {\n        rs.push(ps - w + 1);\n      }\n      if (ps % w !== 0 || ps == 0) {\n        rs.push(ps - w - 1);\n      }\n      return rs;\n    },\n    'MK-1': function (ps) {\n      var rs = [ps, ps + w, ps + 3 * w];\n      if (ps % w !== w - 1) {\n        rs.push(ps + 2 * w + 1);\n        rs.push(ps + 3 * w + 2);\n        rs.push(ps + 4 * w + 1);\n      }\n      if (ps % w !== 0) {\n        rs.push(ps + 2 * w - 1);\n        rs.push(ps + 3 * w - 2);\n        rs.push(ps + 4 * w - 1);\n      }\n      return rs;\n    },\n    'MK-2': function (ps) {\n      var rs = [ps, ps + w, ps + 3 * w];\n      if (ps % w !== w - 1) {\n        rs.push(ps + 2 * w + 1);\n      }\n      if (ps % w !== 0) {\n        rs.push(ps + 2 * w - 1);\n      }\n      return rs;\n    },\n    'MK-3': function (ps) {\n      var rs = [ps, ps + w, ps + 2 * w, ps + 4 * w,];\n      if (ps % w !== w - 1) {\n        rs.push(ps + 2 * w + 1);\n        rs.push(ps + 3 * w + 1);\n      }\n      if (ps % w !== 0) {\n        rs.push(ps + 2 * w - 1);\n        rs.push(ps + 3 * w - 1);\n      }\n      return rs;\n    },\n  };\n\n  function createEnemy(obj) {\n    this.name = obj.name; //名字\n    this.life = obj.life; //生命值\n    this.mainX = obj.position;\n    this.position = obj.position; //位置\n    this.shot = obj.shot; //會不會發射子彈\n    this.shotTime = obj.shotTime; //連發數\n    this.movePath = obj.movePath; //移動的路徑類型\n    this.moveTime = obj.moveTime || 1; // 移動間隔\n    this.look = obj.look;\n\n    var hit = false;\n    var survivalTime = 0;\n    var hitPath = lookPath[this.look](this.position).map(function () {\n      return true;\n    });\n\n    this.getST = function () {\n      return survivalTime;\n    };\n    this.wasHit = function (bulletPs, viewDom, cb) {\n      var me = this;\n      if (lookPath[this.look](this.position).includes(bulletPs)) {\n        hitPath[lookPath[this.look](this.position).indexOf(bulletPs)] = false;\n        hit = true;\n        this.life--;\n        if (this.life < 1) {\n          renderData.enemy.find(function (el, index) {\n            if (el === me) {\n              var bestScore = localStorage.getItem('bestScore');\n              renderData.enemy.splice(index, 1);\n              killCount++;\n              if (bestScore < killCount) localStorage.setItem('bestScore', killCount);\n            }\n          })\n        };\n        this.grapic.call(this, viewDom);\n        if (cb) cb();\n      }\n    };\n\n    this.grapic = function (viewDom) {\n      var color = hit ? 'red' : 'white';\n      lookPath[this.look](this.position).forEach(function (ps, index) {\n        if (hitPath[index]) {\n          var psObj = positionToXY(ps);\n          viewDom.beginPath();\n          viewDom.rect(psObj.x - pixelWeigth / 2, psObj.y, pixelWeigth, pixelWeigth);\n          viewDom.fillStyle = color;\n          viewDom.fill();\n        }\n      });\n    };\n\n    this.action = function (renderType, viewDom) {\n      this.grapic.call(this, viewDom);\n      if (renderType === 'OBJ_MOVE') {\n        enemyMove.call(this);\n        if (survivalTime % this.shotTime === 0) {\n          if (this.shot) shotByEnemy(this.position);\n        };\n        survivalTime++;\n        hit = false;\n      }\n    };\n  }\n\n  function enemyMove() {\n    if (movePathList[this.movePath] && this.getST() % this.moveTime == 0) movePathList[this.movePath].call(this);\n  };\n\n  function positionLimit(nowPosition) {\n    var leftlimt = this.mainX - (this.mainX % w);\n    var rightlimt = leftlimt + w - 1;\n    this.mainX += w;\n    if (nowPosition > rightlimt) {\n      return rightlimt;\n    }\n    if (nowPosition < leftlimt) {\n      return leftlimt;\n    }\n    return nowPosition;\n  };\n\n  function keyCodeMap(keycode, type) {\n    var map = {\n      38: function () {\n        if (type == 'keydown') keyType.UP = true;\n        if (type == 'keyup') keyType.UP = false;\n      },\n      39: function () {\n        if (type == 'keydown') keyType.RIGHT = true;\n        if (type == 'keyup') keyType.RIGHT = false;\n      },\n      40: function () {\n        if (type == 'keydown') keyType.DOWN = true;\n        if (type == 'keyup') keyType.DOWN = false;\n      },\n      37: function () {\n        if (type == 'keydown') keyType.LEFT = true;\n        if (type == 'keyup') keyType.LEFT = false;\n      },\n      32: function () {\n        if (type == 'keydown') keyType.SPACE = true;\n        if (type == 'keyup') keyType.SPACE = false;\n      }\n    };\n\n    if (map[keycode]) {\n      map[keycode]();\n    }\n  }\n\n  function actionMove() {\n    var action = {\n      UP: function () {\n        var ps = renderData.position;\n        renderData.position = (ps - w > -1) ? ps - w : ps;\n      },\n      RIGHT: function () {\n        var ps = renderData.position;\n        if (ps + 1 <= w * h - 1) {\n          if ((ps + 1) % w !== 0) {\n            renderData.position = ps + 1;\n          }\n        }\n      },\n      DOWN: function () {\n        var ps = renderData.position;\n        var nowY = Math.round((ps - ps % w) / w);\n        if (ps + w < w * h) {\n          renderData.position = (nowY < h) ? ps + w : ps;\n        }\n      },\n      LEFT: function () {\n        var ps = renderData.position;\n        if (ps - 1 > -1) {\n          if (ps % w !== 0) {\n            renderData.position = ps - 1;\n          }\n        }\n      },\n      SPACE: function () {\n        shot();\n      }\n    };\n    for (var key in keyType) {\n      if (keyType[key] == true) action[key]();\n      document.getElementById('debug').innerHTML = JSON.stringify(positionToXY(renderData.position), null, 2);\n    }\n    render('PLAYER_MOVE');\n  }\n\n  function objPosition(isSet) {\n    var objArr = renderData.object;\n    var quantity = objQuantity;\n\n    if (isSet) {\n      for (var x = 0; x < quantity; x++) {\n        objArr.push(Math.floor(Math.random() * w));\n      }\n    }\n\n    for (var key in objArr) {\n      var val = objArr[key];\n      objArr[key] = objArr[key] + w;\n    }\n\n    for (var key in objArr) {\n      if (objArr[key] > w * h - 1) {\n        objArr.splice(key, 1);\n      };\n    }\n\n  }\n\n  function shot() {\n    var bulletArr = renderData.bullet;\n    if (!bulletArr.includes(renderData.position - w)) bulletArr.push(renderData.position - w);\n    // if (!atc.isMobile()) synth.triggerAttackRelease('C4',0.1,0);\n    // synth.triggerAttackRelease('C4', 0.2, 0);\n  }\n\n  function shotByEnemy(position) {\n    var bulletArr = renderData.enemyBullet;\n    if (!bulletArr.includes(position + w)) bulletArr.push(position + w);\n  }\n\n  function bulletPosition() {\n    var bulletArr = renderData.bullet;\n    var enemyBulleArr = renderData.enemyBullet;\n    for (var key in bulletArr) {\n      bulletArr[key] = bulletArr[key] - w;\n      if (bulletArr[key] < 0) {\n        bulletArr.splice(key, 1);\n      };\n    }\n    for (var key in enemyBulleArr) {\n      enemyBulleArr[key] = enemyBulleArr[key] + w;\n      if (enemyBulleArr[key] > w * h + 1) {\n        enemyBulleArr.splice(key, 1);\n      };\n    }\n  }\n\n  function delArr(arr, val) {\n    for (var key in arr) {\n      if (arr[key] == val) {\n        arr.splice(key, 1);\n      }\n    }\n  }\n\n  function gaphicShip(data) {\n    // var color = hit ? 'red' : 'white';\n    var viewDom = data.viewDom;\n    lookPath[data.lookType](data.position).forEach(function (ps, index) {\n      var psObj = positionToXY(ps);\n      viewDom.beginPath();\n      viewDom.rect(psObj.x - pixelWeigth / 2, psObj.y, pixelWeigth, pixelWeigth + 1);\n      viewDom.fillStyle = 'white';\n      viewDom.fill();\n    });\n  };\n\n  function gaphic(TYPE) {\n    var bestScore = localStorage.getItem('bestScore') || 0;\n    var bestMileage = localStorage.getItem('bestMileage') || 0;\n    var shipLookType = 'MK-1';\n\n    if (!renderData.position && renderData.position !== 0) {\n      renderData.position = w * Math.floor(h / 2) - Math.floor(w / 2);\n    }\n\n    if (TYPE === 'OBJ_MOVE') {\n      var createObj = false;\n      if (renCount == nextPolling) {\n        for (var x = 0; x < objQuantity; x++) {\n          var zark = new createEnemy({\n            name: 'ZARK-ZERO',\n            life: 3,\n            position: Math.floor(Math.random() * w),\n            shot: true,\n            shotTime: 3,\n            movePath: 'gostMove',\n            moveTime: 5,\n            look: 'zark',\n          });\n          renderData.enemy.push(zark);\n        }\n        nextPolling = renCount + Math.floor(Math.random() * objPolling[1] + objPolling[0]);\n      }\n      // document.getElementById('debug').innerHTML = nextPolling + ', ' + renCount;\n      objPosition(createObj);\n      renCount++;\n      if (bestMileage < renCount) localStorage.setItem('bestMileage', renCount);\n    }\n\n    if (TYPE === 'BULLET_MOVE') {\n      bulletPosition();\n    }\n\n    //canvas\n    var viewDom = document.getElementById('view').getContext('2d');\n    viewDom.clearRect(0, 0, window.innerWidth, window.innerHeight);\n\n    // bullet\n    var enemyBulleArr = renderData.enemyBullet;\n    var bulletImg = document.getElementById(\"bulletImg\");\n    renderData.bullet.map(function (ps) {\n      var bulletObj = positionToXY(ps);\n      viewDom.drawImage(bulletImg, bulletObj.x - 13 / 2, bulletObj.y - 5, 13, 64);\n\n      //defense\n      // console.log(ps, enemyBulleArr);\n      if (enemyBulleArr.includes(ps)) {\n        enemyBulleArr.splice(enemyBulleArr.indexOf(ps), 1);\n        renderData.bullet.splice(renderData.bullet.indexOf(ps), 1);\n      }\n      if (enemyBulleArr.includes(ps + w)) {\n        enemyBulleArr.splice(enemyBulleArr.indexOf(ps + w), 1);\n        renderData.bullet.splice(renderData.bullet.indexOf(ps), 1);\n      }\n\n      //kill enemy\n      renderData.enemy.map(function (obj) {\n        obj.wasHit(ps, viewDom, function () {\n          renderData.bullet.splice(renderData.bullet.indexOf(ps), 1);\n        });\n        obj.wasHit(ps + w, viewDom, function () {\n          renderData.bullet.splice(renderData.bullet.indexOf(ps), 1);\n        });\n      })\n    })\n\n    // ship\n    gaphicShip({\n      viewDom: viewDom,\n      lookType: shipLookType,\n      position: renderData.position,\n    });\n\n    //enmyBullet\n    var enemyImg = document.getElementById(\"enemyImg\");\n    renderData.enemyBullet.map(function (ps) {\n      var bulletObj = positionToXY(ps);\n      viewDom.drawImage(enemyImg, bulletObj.x - 15 / 2, bulletObj.y - 5, 15, 15);\n    })\n\n    // enmy\n    renderData.enemy.map(function (obj) {\n      obj.action(TYPE, viewDom);\n    })\n\n    document.getElementById('score').innerHTML = 'Score: <div class=\"score\">' + killCount +\n      '</div><br/>Best score: ' + (localStorage.getItem('bestScore') || 0) +\n      '<br/> Mileage: ' + renCount +\n      '<br/> Best Mileage: ' + bestMileage;\n\n    var dead = false;\n    if (isDead(renderData.position, shipLookType)) {\n      renCount = 0;\n      nextPolling = 20;\n      renderData.renderTemp = {};\n      killCount = 0;\n      dead = true;\n      console.log('dead');\n    }\n\n  }\n\n  function isDead(point, shipLookType) {\n    var rs = false;\n    renderData.enemyBullet.forEach(function (ps) {\n      if (lookPath[shipLookType](point).includes(ps)) rs = true;\n    })\n    renderData.enemy.map(function (enemy) {\n      if (lookPath[shipLookType](point).includes(enemy.position)) rs = true;\n    })\n    return rs;\n  }\n\n  function render(TYPE) {\n    gaphic(TYPE);\n  }\n\n  function positionToXY(ps) {\n    var x = ps % w;\n    var y = Math.round((ps - x) / w);\n    return {\n      ps: ps,\n      x: x * pixelWeigth + pixelWeigth / 2,\n      //y: Math.round(y / h) * pixelWeigth,\n      // y: Math.round(y / h) * window.innerHeight / h,\n      y: y * window.innerHeight / h,\n      __x: x,\n      __y: y,\n      limit: w * h - 1,\n    };\n  }\n\n  document.addEventListener('keydown', function (e) {\n    keyCodeMap(e.keyCode, 'keydown');\n  }, false);\n\n  document.addEventListener('keyup', function (e) {\n    keyCodeMap(e.keyCode, 'keyup');\n  }, false);\n\n\n  document.addEventListener('touchstart', touch, false);\n  document.addEventListener('touchmove', touch, false);\n  document.addEventListener('touchend', touch, false);\n\n  function touch(event) {\n    var event = event || window.event;\n    event.preventDefault();\n    var x = Math.floor(event.touches[0].pageX / pixelWeigth);\n    var y = Math.floor(event.touches[0].pageY / pixelWeigth);\n    var _ps = (w * y + x);\n    renderData.position = _ps;\n    shot();\n    document.getElementById(\"debug\").innerHTML = \"Touch moved (\" + x + \",\" + y + \"), \" + (w * y + x);\n  }\n\n  document.getElementById('view').height = window.innerHeight;\n  document.getElementById('view').width = window.innerWidth;\n  setInterval(function () {\n    render('OBJ_MOVE')\n  }, renderTime);\n  setInterval(function () {\n    render('BULLET_MOVE')\n    actionMove()\n  }, bulletTime);\n\n})();\n"]}